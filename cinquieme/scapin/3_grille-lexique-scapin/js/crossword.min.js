var ctx=null,csiz=30,scalex=1,scaley=1,resizeDelay=null,selectedcell=null,c_r=[],gameover=!1,alt=0,cleanerr=!1,seconds=0,stoptimer=!1,secondkey=!1,layout=null;is_touch_device=function(){try{return document.createEvent("TouchEvent"),!0}catch(g){return!1}};
$(function(){trim=function(a){return a?a.replace(/^\s+|\s+$/g,""):""};$(".button").mousedown(function(a){$(a.target).addClass("pushed")});$(".button").mouseup(function(a){$(a.target).removeClass("pushed")});$("#canvas").bind("orientationchange",function(){setTimeout("calcsize();",300)});layout=$("#container").layout({east__size:270,east__spacing_open:0,east__closable:!1,west__resizable:!1,center__onresize:"innerlayout.resizeAll",applyDefaultStyles:!0});calcsize=function(){$("#down-clues").css("height",
(window.innerHeight-$("#across-header").outerHeight(!0)-$("#down-header").outerHeight(!0)-50)/2);$("#across-clues").css("height",(window.innerHeight-$("#across-header").outerHeight(!0)-$("#down-header").outerHeight(!0)-20)/2);$("#main").css("height",window.innerHeight+"px");$("#mcenter").css("height",$("#main").innerHeight()-3-$("#toolbar").innerHeight()-$("#heading").innerHeight()+"px");$("#wbank").css("height",window.innerHeight+"px");if(ctx){for(var a=scaley=scalex=0;scalex<0.75||scaley<0.75;){var b=
Math.min($("#mcenter").innerWidth(),$("#mcenter").innerHeight())+a;$("#canvas").css("width",b-12+"px");$("#canvas").css("height",b-12+"px");ctx.canvas.width=b-12;ctx.canvas.height=b-12;scalex=$("#canvas").innerWidth()/Math.max(csiz*pwidth,csiz*pheight);scaley=$("#canvas").innerHeight()/Math.max(csiz*pwidth,csiz*pheight);a+=2}ctx.scale(scalex,scaley)}$("#canvas").css("left",Math.max(10,($("#mcenter").innerWidth()-$("#canvas").innerWidth())/2)+"px");selectedcell&&se_atcell(selectedcell);render()};window.onresize=
function(){is_touch_device()||(clearTimeout(resizeDelay),resizeDelay=setTimeout("calcsize();",500))};ce_hit_test=function(a,b,c){var d=c.x,c=c.y;return a>scalex*d*csiz&&a<scalex*(d+1)*csiz&&b>scaley*c*csiz&&b<scaley*(c+1)*csiz?!0:!1};se_atcell=function(a){$("#editor").val("");$("#editor").css("font-size",0.8*scaley*csiz);$("#editor").css("top",scaley*a.y*csiz+1);$("#editor").css("left",scalex*a.x*csiz+parseInt($("#canvas").css("left"),10)+2);$("#editor").css("height",scaley*csiz-3);$("#editor").css("width",
scalex*csiz-4);$("#editor").show();setTimeout(function(){$("#editor").focus()},50)};hit_test=function(a,b){for(var c=!1,d=0;d<fcs.length;d++)if(ce_hit_test(a,b,fcs[d])){if(!fcs[d].filled)fcs[d].selected=!0,selectedcell=fcs[d],se_atcell(fcs[d]),selectedcell.number>0&&select_clue(selectedcell.x,selectedcell.y),c=!0}else fcs[d].selected=!1;c&&render()};mv_cl=function(a,b){if(c_r[a+","+b]){if(selectedcell)selectedcell.selected=!1;$("#editor").hide();var c=trim($("#editor").val());c.length>0&&en_txt(c[0].toUpperCase(),
!1);if(!c_r[a+","+b].filled)return c_r[a+","+b].selected=!0,selectedcell=c_r[a+","+b],selectedcell.number>0&&select_clue(a,b),se_atcell(selectedcell),render(),!0}return!1};dr_sh=function(a){var b=a.x,a=a.y;if(ctx)ctx.fillStyle=excol,ctx.fillRect(csiz*b+3,csiz*a+3,csiz,csiz)};dr_ce=function(a){var b=a.x,c=a.y,d=a.number;if(ctx){ctx.strokeStyle=fgc;ctx.strokeRect(csiz*b,csiz*c,csiz,csiz);ctx.fillStyle=a.selected?a.incorrect?"#FF0000":hcol:a.incorrect?"#FF0000":a.filled?excol:ccol;ctx.fillRect(csiz*
b+1,csiz*c+1,csiz-2,csiz-2);if(d>0)ctx.fillStyle=fgc,ctx.font="12px Tahoma",ctx.fillText(d,csiz*b+3,csiz*c+12);if(a.text)ctx.fillStyle=a.incorrect?"#FFFFFF":tcol,ctx.font="16px Tahoma",d=ctx.measureText(a.text),ctx.fillText(a.text,csiz*b+(csiz-d.width)/2,csiz*c+(csiz+12)/2)}};flash_hint=function(){var a=null,b=null,c=null;if(selectedcell){for(var b=selectedcell.x,c=selectedcell.y,d=0;d<pls.length;d++){var e=pls[d],f=e.direction;if(f=="EAST"){if(e.y==c&&(f=b-e.x,f<e.word.length)){a=e.word[f];break}}else if(f==
"SOUTH"&&e.x==b&&(f=c-e.y,f<e.word.length)){a=e.word[f];break}}if(a)selectedcell.text=a,render()}};solve_puzzle=function(){for(var a=0;a<pls.length;a++){var b=pls[a],c=b.x,d=b.y,e=b.direction;if(e=="EAST")for(e=c;e<c+b.word.length;e++)c_r[e+","+d].text=b.word[e-c];else if(e=="SOUTH")for(e=d;e<d+b.word.length;e++)c_r[c+","+e].text=b.word[e-d]}$("#editor").hide();gameover=!0;render()};select_clue=function(a,b,c){$(".word-bank-word").css("background-color","#FFFFFF");selectedcell&&se_atcell(selectedcell);
if(c){if(a=document.getElementById("cl-"+a+"-"+b+"-"+c))a.scrollIntoView(!1),$(a).css("background-color",hcol),selectedcell.direction=c}else if(c=document.getElementById("cl-"+a+"-"+b+"-EAST"),a=document.getElementById("cl-"+a+"-"+b+"-SOUTH"),c&&a)alt==0?(c.scrollIntoView(!1),$(c).css("background-color",hcol),selectedcell.direction="EAST",alt=1):(a.scrollIntoView(!1),$(a).css("background-color",hcol),selectedcell.direction="SOUTH",alt=0);else if(c)c.scrollIntoView(!1),$(c).css("background-color",
hcol),selectedcell.direction="EAST";else if(a)a.scrollIntoView(!1),$(a).css("background-color",hcol),selectedcell.direction="SOUTH"};bk_sp=function(){if(selectedcell.text)selectedcell.text="";var a=selectedcell.x,b=selectedcell.y;if(selectedcell.direction=="SOUTH")mv_cl(a,b-1,!0),selectedcell.direction="SOUTH";else if(selectedcell.direction=="EAST")mv_cl(a-1,b,!0),selectedcell.direction="EAST";else if(mv_cl(a-1,b,!0))selectedcell.direction="EAST";else if(mv_cl(a,b-1,!0))selectedcell.direction="SOUTH"};
en_txt=function(a,b){if(selectedcell&&(selectedcell.text=a,b)){var c=selectedcell.x,d=selectedcell.y;selectedcell.direction=="SOUTH"?(mv_cl(c,d+1,!0)||($("#editor").hide(),render()),selectedcell.direction="SOUTH"):selectedcell.direction=="EAST"?(mv_cl(c+1,d,!0)||($("#editor").hide(),render()),selectedcell.direction="EAST"):mv_cl(c+1,d,!0)?selectedcell.direction="EAST":mv_cl(c,d+1,!0)?selectedcell.direction="SOUTH":($("#editor").hide(),render())}};render=function(){cleanerr&&(cl_err(),cleanerr=!1);
ctx&&ctx.clearRect(0,0,1E5,1E4);if(hasshadow)for(var a=0;a<fcs.length;a++)dr_sh(fcs[a]);for(a=0;a<fcs.length;a++)dr_ce(fcs[a])};cl_err=function(){for(var a=0;a<fcs.length;a++)fcs[a].incorrect=!1};ve_sol=function(){$("#editor").hide();for(var a=!0,b=0;b<fcs.length;b++){var c=fcs[b];if(!c.filled&&c.text!=c.letter)a=!1,c.incorrect=!0}return a};var g=null;$("#wbank, #toolbar").mousedown(function(){$("#editor").hide()});$("#mcenter").css("background-color",bgc);document.getElementById("canvas").getContext&&
(ctx=document.getElementById("canvas").getContext("2d"));for(var h=0;h<fcs.length;h++)c_r[fcs[h].x+","+fcs[h].y]=fcs[h];hassolve||$("#solve").hide();hashint||$("#hint").hide();hasinstr?$("#instr-body").html(instr):$("#centerpoint").hide();$.browser.msie&&$.browser.version<9?($("#centerpoint").hide(),$("#mcenter").css("overflow","hidden"),$("#iepage").html("<h2>Sorry, this website does not support your browser.</h2><p> Please try again with one of the following browsers:</p><table style='text-align:center;' cellspacing=15><tr><td><img src='css/images/chrome.png' class='browser-icon'></td><td><img src='css/images/firefox.png' class='browser-icon'></td><td><img src='css/images/Safari.png' class='browser-icon'></td><td><img src='css/images/Opera.png' class='browser-icon'></td></tr><td><a href='http://www.google.com/chrome'>Google Chrome</a></td><td><a href='http://www.mozilla.com/'>Firefox</a></td><td><a href='http://www.apple.com/safari/'>Safari</a></td><td><a href='http://www.opera.com/'>Opera</a></td></tr></table>")):
$("#iepage").remove();is_touch_device()&&(document.addEventListener("touchstart",function(a){if(a.touches.length==1){var a=a.changedTouches[0],b=document.createEvent("MouseEvent");b.initMouseEvent("mousedown",!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(b)}}),document.addEventListener("touchmove",function(a){if(a.touches.length==1){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent("mousemove",!0,!0,window,1,b.screenX,
b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(c);a.preventDefault()}}),document.addEventListener("touchend",function(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent("mouseup",!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(c);a.preventDefault()}));document.title="Crossword - "+puzh;$("#heading").html(puzh);$("#heading").css("color",headcol);$("#across-header").html(ablab);$("#down-header").html(dlab);
hintbtntext&&$("#hint").html(hintbtntext);solvebtntext&&$("#solve").html(solvebtntext);checksoltext&&$("#check").html(checksoltext);for(h=0;h<pls.length;h++){var f=pls[h],i=f.direction;i=="SOUTH"?$("#down-clues").append('<div id="cl-'+f.x+"-"+f.y+"-"+f.direction+'" class="word-bank-word">'+f.number+") "+f.clue+"</div>"):i=="EAST"&&$("#across-clues").append('<div id="cl-'+f.x+"-"+f.y+"-"+f.direction+'" class="word-bank-word">'+f.number+") "+f.clue+"</div>")}$(".word-bank-word").css("color",cluecol);
$(".word-bank-word").css("cursor","pointer");$(".word-bank-word").click(function(){g&&g.close();var a=$(this).attr("id").split("-");if(a.length==4){if(selectedcell)selectedcell.selected=!1;c_r[a[1]+","+a[2]].selected=!0;selectedcell=c_r[a[1]+","+a[2]];select_clue(a[1],a[2],a[3]);render()}});$("#canvas").mousedown(function(a){g&&g.close();var b,c;if(a.offsetX)b=a.offsetX,c=a.offsetY;else if(a.layerX)b=a.layerX,c=a.layerY;$("#editor").hide();a=trim($("#editor").val());a.length>0&&en_txt(a[0].toUpperCase(),
!1);hit_test(b,c)});show_success_notification=function(a,b,c){return $scontainer.notify("create",b,c,a)};show_failure_notification=function(a,b,c){return $fcontainer.notify("create",b,c,a)};$scontainer=$("#snotify").notify();$fcontainer=$("#fnotify").notify();onverifysol=function(){g&&g.close();ve_sol()?(g=show_success_notification("default",{title:fintitle,text:finmsg},{speed:600,stack:"above",expires:!1}),gameover=stoptimer=!0):(g=show_failure_notification("default",{title:errtitle,text:errmsg},
{speed:600,stack:"above",expires:!1}),render(),cleanerr=!0)};tick_second=function(){seconds==null?seconds=0:seconds+=1;var a=0,b=seconds;seconds>=0&&(a=Math.floor(seconds/60),b=seconds-a*60,b<10&&(b="0"+b));$("#timer").html(timertext+": "+a+":"+b);stoptimer||setTimeout(function(){tick_second()},1E3)};hastimer&&tick_second();$("#editor").bind("keydown",function(a){if(selectedcell){var b=selectedcell.x,c=selectedcell.y;a.which==39?mv_cl(b+1,c):a.which==37?mv_cl(b-1,c):a.which==40?mv_cl(b,c+1):a.which==
38?mv_cl(b,c-1):a.which==9?(en_txt(selectedcell.text,!0),a.preventDefault()):a.which==8?allspch||bk_sp():allspch?a.which==13&&setTimeout(function(){var a=trim($("#editor").val());a.length>0&&en_txt(a[0].toUpperCase(),!0)},50):setTimeout(function(){var a=$("#editor").val();a.length>0&&en_txt(a[0].toUpperCase(),!0)},50)}})});window.onload=function(){calcsize();$("#editor").val("");$("#editor").css("color",tcol);$("#editor").css("background",hcol);$("#editor").hide()};window.onbeforeunload=function(){return""};
